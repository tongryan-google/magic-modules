# Copyright 2025 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
name: Agent
description: Description
base_url: projects/{{project}}/locations/{{location}}/apps/{{app}}/agents
update_mask: true
self_link: projects/{{project}}/locations/{{location}}/apps/{{app}}/agents/{{name}}
create_url: projects/{{project}}/locations/{{location}}/apps/{{app}}/agents?agentId={{agent_id}}
update_verb: PATCH
id_format: projects/{{project}}/locations/{{location}}/apps/{{app}}/agents/{{name}}
import_format:
- projects/{{project}}/locations/{{location}}/apps/{{app}}/agents/{{name}}
examples:
- name: "ces_agent_basic"
  primary_resource_id: "ces_agent_basic"
  vars:
    agent_display_name: 'my-agent'
    app_display_name: 'my-app'
    agent_id: 'agent-id'
    app_id: 'app-id'
- name: "ces_agent_remote_dialogflow_agent"
  primary_resource_id: "ces_agent_remote_dialogflow_agent"
  vars:
    agent_display_name: 'my-agent'
    app_display_name: 'my-app'
    agent_id: 'agent-id'
    app_id: 'app-id'
parameters:
- name: location
  type: String
  description: Resource ID segment making up resource `name`. It identifies the resource within its parent collection as described in https://google.aip.dev/122.
  immutable: true
  url_param_only: true
  required: true
- name: app
  type: String
  description: Resource ID segment making up resource `name`. It identifies the resource within its parent collection as described in https://google.aip.dev/122.
  immutable: true
  url_param_only: true
  required: true
- name: agentId
  type: String
  description: |-
    The ID to use for the agent, which will become the final component of
    the agent's resource name. If not provided, a unique ID will be
    automatically assigned for the agent.
  immutable: true
  url_param_only: true
  required: true
properties:
- name: afterAgentCallbacks
  type: Array
  description: |-
    The callbacks to execute after the agent is called.
    The provided callbacks are executed sequentially in the exact order they
    are given in the list. If a callback returns an overridden response,
    execution stops and any remaining callbacks are skipped.
  item_type:
    type: NestedObject
    properties:
    - name: description
      type: String
      description: Human-readable description of the callback.
    - name: disabled
      type: Boolean
      description: |-
        Whether the callback is disabled. Disabled callbacks are ignored by the
        agent.
    - name: pythonCode
      type: String
      description: The python code to execute for the callback.
      required: true
- name: afterModelCallbacks
  type: Array
  description: |-
    The callbacks to execute after the model is called. If there are multiple
    calls to the model, the callback will be executed multiple times.
    The provided callbacks are executed sequentially in the exact order they
    are given in the list. If a callback returns an overridden response,
    execution stops and any remaining callbacks are skipped.
  item_type:
    type: NestedObject
    properties:
    - name: description
      type: String
      description: Human-readable description of the callback.
    - name: disabled
      type: Boolean
      description: |-
        Whether the callback is disabled. Disabled callbacks are ignored by the
        agent.
    - name: pythonCode
      type: String
      description: The python code to execute for the callback.
      required: true
- name: afterToolCallbacks
  type: Array
  description: |-
    The callbacks to execute after the tool is invoked. If there are multiple
    tool invocations, the callback will be executed multiple times.
    The provided callbacks are executed sequentially in the exact order they
    are given in the list. If a callback returns an overridden response,
    execution stops and any remaining callbacks are skipped.
  item_type:
    type: NestedObject
    properties:
    - name: description
      type: String
      description: Human-readable description of the callback.
    - name: disabled
      type: Boolean
      description: |-
        Whether the callback is disabled. Disabled callbacks are ignored by the
        agent.
    - name: pythonCode
      type: String
      description: The python code to execute for the callback.
      required: true
- name: beforeAgentCallbacks
  type: Array
  description: |-
    The callbacks to execute before the agent is called.
    The provided callbacks are executed sequentially in the exact order they
    are given in the list. If a callback returns an overridden response,
    execution stops and any remaining callbacks are skipped.
  item_type:
    type: NestedObject
    properties:
    - name: description
      type: String
      description: Human-readable description of the callback.
    - name: disabled
      type: Boolean
      description: |-
        Whether the callback is disabled. Disabled callbacks are ignored by the
        agent.
    - name: pythonCode
      type: String
      description: The python code to execute for the callback.
      required: true
- name: beforeModelCallbacks
  type: Array
  description: |-
    The callbacks to execute before the model is called. If there are multiple
    calls to the model, the callback will be executed multiple times.
    The provided callbacks are executed sequentially in the exact order they
    are given in the list. If a callback returns an overridden response,
    execution stops and any remaining callbacks are skipped.
  item_type:
    type: NestedObject
    properties:
    - name: description
      type: String
      description: Human-readable description of the callback.
    - name: disabled
      type: Boolean
      description: |-
        Whether the callback is disabled. Disabled callbacks are ignored by the
        agent.
    - name: pythonCode
      type: String
      description: The python code to execute for the callback.
      required: true
- name: beforeToolCallbacks
  type: Array
  description: |-
    The callbacks to execute before the tool is invoked. If there are multiple
    tool invocations, the callback will be executed multiple times.
    The provided callbacks are executed sequentially in the exact order they
    are given in the list. If a callback returns an overridden response,
    execution stops and any remaining callbacks are skipped.
  item_type:
    type: NestedObject
    properties:
    - name: description
      type: String
      description: Human-readable description of the callback.
    - name: disabled
      type: Boolean
      description: |-
        Whether the callback is disabled. Disabled callbacks are ignored by the
        agent.
    - name: pythonCode
      type: String
      description: The python code to execute for the callback.
      required: true
- name: childAgents
  type: Array
  description: |-
    List of child agents in the agent tree.
    Format: `projects/{project}/locations/{location}/apps/{app}/agents/{agent}`
  item_type:
    type: String
- name: createTime
  type: String
  description: Timestamp when the agent was created.
  output: true
- name: description
  type: String
  description: Human-readable description of the agent.
- name: displayName
  type: String
  description: Display name of the agent.
  required: true
- name: etag
  type: String
  description: |-
    Etag used to ensure the object hasn't changed during a read-modify-write
    operation. If the etag is empty, the update will overwrite any concurrent
    changes.
  output: true
- name: generatedSummary
  type: String
  description: |-
    If the agent is generated by the LLM assistant, this field contains a
    descriptive summary of the generation.
  output: true
- name: guardrails
  type: Array
  description: |-
    List of guardrails for the agent.
    Format:
    `projects/{project}/locations/{location}/apps/{app}/guardrails/{guardrail}`
  item_type:
    type: String
- name: instruction
  type: String
  description: Instructions for the LLM model to guide the agent's behavior.
- name: modelSettings
  type: NestedObject
  description: Model settings contains various configurations for the LLM model.
  properties:
  - name: model
    type: String
    description: |-
      The LLM model that the agent should use.
      If not set, the agent will inherit the model from its parent agent.
  - name: temperature
    type: Double
    description: |-
      If set, this temperature will be used for the LLM model. Temperature
      controls the randomness of the model's responses. Lower temperatures
      produce responses that are more predictable. Higher temperatures produce
      responses that are more creative.
- name: name
  type: String
  description: |-
    Identifier. The unique identifier of the agent.
    Format: `projects/{project}/locations/{location}/apps/{app}/agents/{agent}`
  output: true
  custom_flatten: 'templates/terraform/custom_flatten/name_from_self_link.tmpl'
- name: llmAgent
  type: NestedObject
  description: |-
    Default agent type. The agent uses instructions and callbacks specified in
    the agent to perform the task using a large language model.
  allow_empty_object: true
  send_empty_value: true
  properties:
    []
- name: remoteDialogflowAgent
  type: NestedObject
  description: |-
    The agent which will transfer execution to an existing remote
    [Dialogflow](https://cloud.google.com/dialogflow/cx/docs/concept/console-conversational-agents)
    agent flow. The corresponding Dialogflow agent will process subsequent user
    queries until the session ends or flow ends and the control is transferred
    back to the parent CES agent.
  properties:
  - name: agent
    type: String
    description: |-
      The
      [Dialogflow](https://cloud.google.com/dialogflow/cx/docs/concept/console-conversational-agents
      agent resource name.
      Format: `projects/{project}/locations/{location}/agents/{agent}`
    required: true
  - name: environmentId
    type: String
    description: |-
      The environment ID of the Dialogflow agent be used for the agent
      execution. If not specified, the draft environment will be used.
  - name: flowId
    type: String
    description: The flow ID of the flow in the Dialogflow agent.
    required: true
  - name: inputVariableMapping
    type: KeyValuePairs
    description: |-
      The mapping of the app variables names to the Dialogflow session
      parameters names to be sent to the Dialogflow agent as input.
  - name: outputVariableMapping
    type: KeyValuePairs
    description: |-
      The mapping of the Dialogflow session parameters names to the app
      variables names to be sent back to the CES agent after the Dialogflow
      agent execution ends.
- name: tools
  type: Array
  description: |-
    List of available tools for the agent.
    Format: `projects/{project}/locations/{location}/apps/{app}/tools/{tool}`
  item_type:
    type: String
- name: toolsets
  type: Array
  description: List of toolsets for the agent.
  item_type:
    type: NestedObject
    properties:
    - name: toolPredicates
      type: Array
      description: The predicates to filter the toolset.
      item_type:
        type: NestedObject
        properties:
        - name: connectorToolPredicate
          type: NestedObject
          description: A tool predicate that is used to match a Connector tool.
          properties:
          - name: action
            type: NestedObject
            description: |-
              Configuration of an Action for the tool to use.
              Note: This can be either an Action or an Operation. See
              https://cloud.google.com/integration-connectors/docs/entities-operation-action
              for details.
            properties:
            - name: connectionActionId
              type: String
              description: ID of a Connection action for the tool to use.
            - name: entityOperation
              type: NestedObject
              description: Entity CRUD operation specification.
              properties:
              - name: entityId
                type: String
                description: ID of the entity.
                required: true
              - name: operation
                type: String
                description: |-
                  Operation to perform on the entity.
                  Possible values:
                  LIST
                  GET
                  CREATE
                  UPDATE
                  DELETE
                required: true
            - name: inputFields
              type: Array
              description: |-
                Entity fields to use as inputs for the operation.
                If no fields are specified, all fields of the Entity will be used.
              item_type:
                type: String
            - name: outputFields
              type: Array
              description: |-
                Entity fields to return from the operation.
                If no fields are specified, all fields of the Entity will be returned.
              item_type:
                type: String
        - name: displayName
          type: String
          description: |-
            The display name of the tool predicate and matches the tool predicate
            set.
          output: true
        - name: mcpToolPredicate
          type: NestedObject
          description: A tool predicate that is used to match a MCP tool.
          properties:
          - name: toolName
            type: String
            description: The name of the individual tool in the MCP toolset.
            required: true
        - name: openApiToolPredicate
          type: NestedObject
          description: |-
            A tool predicate that is used to match an OpenAPI tool.
            If `operation_id` is specified, OpenAPI tools with the matching operation
            ID would be selected. Otherwise, OpenAPI tools with the matching `path` and
            `method` would be returned.
          properties:
          - name: method
            type: String
            description: The HTTP method of the given path.
          - name: operationId
            type: String
            description: The operationId field of the OpenAPI endpoint.
          - name: path
            type: String
            description: The path of the OpenAPI endpoint.
    - name: toolset
      type: String
      description: |-
        The resource name of the toolset.
        Format:
        `projects/{project}/locations/{location}/apps/{app}/toolsets/{toolset}`
      required: true
- name: updateTime
  type: String
  description: Timestamp when the agent was last updated.
  output: true